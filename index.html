<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="icons/favicon.png">
    <title>‚ù§Ô∏è</title>
    <!-- Romantic Font Suite -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Parisienne&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --scale: 0.6; 
            --hex-width: 80px;
            --hex-height: 20px;
            --digit-width: 120px;
            --digit-height: 220px;
            --color-off: rgba(255, 192, 203, 0.1); 
            --color-on: #ffb7c5; 
            --color-glow: #ff69b4; 
            --text-color: #fff0f5;
            
            /* Font Definitions */
            --font-heading: 'Great Vibes', cursive;
            --font-accent: 'Parisienne', cursive;
            --font-body: 'Playfair Display', serif;
        }

        body {
            /* Animated Smoke/Cloud Background */
            background: linear-gradient(135deg, #1a0509, #4a192c, #2c0e18, #1a0509);
            background-size: 400% 400%;
            animation: cloudShift 20s ease infinite;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: 100dvh;
            margin: 0;
            padding: 0;
            font-family: var(--font-body);
            overflow: hidden;
            position: relative;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            box-sizing: border-box;
        }

        @keyframes cloudShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Snow & Heart Layers */
        #snow-canvas, #confetti {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        #snow-canvas { z-index: 2; }
        #confetti { z-index: 1500; } 

        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 5000;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.4);
            padding: 10px 18px;
            border-radius: 30px;
            cursor: pointer;
            color: white;
            font-size: 0.75rem;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s;
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: calc(100% - 40px);
        }

        #lyrics-container {
            margin-top: 5px;
            height: 40px;
            overflow: hidden;
            width: 90%;
            max-width: 500px;
            text-align: center;
            z-index: 10;
        }
        #lyric-text {
            font-size: clamp(1.1rem, 4.5vw, 1.4rem);
            font-family: var(--font-accent);
            color: #fff;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            text-shadow: 0 0 15px rgba(255, 105, 180, 1);
        }

        #header-container {
            text-align: center;
            z-index: 10;
            transition: opacity 1s ease;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 15px;
            box-sizing: border-box;
            transform-origin: center;
        }
        h2 {
            margin: 0 0 5px 0;
            color: #ffffff;
            font-family: var(--font-heading);
            font-size: clamp(2.8rem, 10vw, 5.5rem);
            font-weight: normal;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 2px 2px 4px rgba(0,0,0,0.8);
        }
        .subtitle {
            font-family: var(--font-accent);
            font-size: clamp(1.1rem, 4.5vw, 1.6rem);
            margin-bottom: 5px;
            opacity: 1;
            color: #ffb7c5;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .music-prompt-btn {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #ffffff;
            padding: 10px 24px;
            border-radius: 50px;
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            cursor: pointer;
            transition: all 0.3s;
            font-family: var(--font-accent);
            backdrop-filter: blur(5px);
            margin-bottom: 15px;
        }

        /* Responsive Clock Grid */
        .clock-wrapper {
            display: grid;
            grid-template-columns: repeat(4, auto); 
            justify-content: center;
            align-items: center;
            gap: clamp(10px, 3vw, 25px);
            padding: clamp(15px, 4vw, 35px);
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            backdrop-filter: blur(15px);
            transform: scale(var(--scale));
            transform-origin: top center;
            z-index: 10;
            transition: opacity 1s ease, transform 1s ease;
            width: fit-content;
            margin: 0 auto;
        }

        @media (max-width: 900px) { 
            :root { --scale: 0.38; }
            .clock-wrapper { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px; 
                padding: 20px; 
            } 
        }
        @media (max-width: 480px) { 
            :root { --scale: 0.32; }
            .clock-wrapper { gap: 10px; }
        }
        @media (max-width: 360px) { 
            :root { --scale: 0.26; }
        }

        .time-group { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background: rgba(255, 255, 255, 0.03);
            padding: clamp(15px, 4vw, 25px);
            border-radius: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .digits-row { display: flex; gap: 12px; }
        
        .label { 
            margin-top: 20px; 
            font-size: 2.8rem; 
            color: #ffffff; 
            font-family: var(--font-accent);
            text-shadow: 0 0 15px rgba(255, 105, 180, 0.8);
        }

        .digit { position: relative; width: var(--digit-width); height: var(--digit-height); }
        .hexagon {
            width: var(--hex-width); height: var(--hex-height);
            background-color: var(--color-off);
            position: absolute;
            clip-path: polygon(15% 0%, 85% 0%, 100% 50%, 85% 100%, 15% 100%, 0% 50%);
            transition: all 0.4s ease;
        }
        .hexagon.on {
            background-color: var(--color-on);
            box-shadow: 0 0 20px var(--color-glow), 0 0 40px var(--color-glow);
        }
        .seg-0 { top: 0; left: 20px; }
        .seg-1 { top: 50px; left: -24px; transform: rotate(90deg); }
        .seg-2 { top: 50px; left: 64px; transform: rotate(90deg); }
        .seg-3 { top: 100px; left: 20px; }
        .seg-4 { top: 150px; left: -24px; transform: rotate(90deg); }
        .seg-5 { top: 150px; left: 64px; transform: rotate(90deg); }
        .seg-6 { top: 200px; left: 20px; }

        #love-letter {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 88%;
            max-width: 480px;
            background: rgba(40, 10, 20, 0.9);
            backdrop-filter: blur(25px);
            padding: clamp(35px, 10vw, 60px) clamp(20px, 6vw, 45px);
            border-radius: 40px;
            border: 1px solid rgba(255, 182, 193, 0.4);
            text-align: center;
            opacity: 0;
            display: none; 
            z-index: 500;
            transition: opacity 1s ease, transform 1s ease;
            box-sizing: border-box;
        }
        #love-letter.visible { opacity: 1; transform: translate(-50%, -50%) scale(1); display: block; pointer-events: auto; }

        .letter-content h1 { font-family: var(--font-heading); font-size: clamp(3rem, 10vw, 4.2rem); color: #ff69b4; margin-bottom: 15px; }
        .letter-content p { font-size: clamp(1.1rem, 4vw, 1.3rem); line-height: 1.7; margin-bottom: 30px; color: #ffe4e1; font-style: italic; }

        .action-btn {
            background: linear-gradient(45deg, #ff69b4, #ffb7c5);
            color: #2c0e18;
            border: none;
            padding: 18px 40px;
            font-size: clamp(1rem, 4vw, 1.3rem);
            font-family: var(--font-accent);
            font-weight: bold;
            border-radius: 60px;
            cursor: pointer;
            margin: 12px 0;
            width: 100%;
            max-width: 320px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            z-index: 600;
            box-shadow: 0 5px 25px rgba(255, 105, 180, 0.4);
        }
        .action-btn:active { transform: scale(0.95); }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .heartbeat-pulse { animation: heartbeat 1.5s ease-in-out infinite; }

        #memories-gallery {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            z-index: 2000;
            opacity: 0;
            display: none; 
            transition: opacity 2s ease;
        }
        #memories-gallery.active { opacity: 1; display: block; pointer-events: auto; }

        .slide {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            transition: opacity 2.5s ease-in-out;
            background-size: cover;
            background-position: center;
            filter: brightness(0.7);
            z-index: 10;
        }
        .slide.active { opacity: 1; animation: kenburns 20s infinite alternate; }
        @keyframes kenburns { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }

        #poem-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 30;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none; 
        }
        #glass-panel {
            width: 94%; max-width: 700px; height: 88%; 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 40px; overflow: hidden; 
            position: relative; pointer-events: auto;
            transition: transform 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 1s ease;
            transform-origin: top center;
        }
        /* PHYSICAL SCROLL ROLL-UP ANIMATION */
        #glass-panel.scroll-wrap { 
            transform: scaleY(0) scaleX(0.05); 
            opacity: 0; 
        }

        #scrolling-text {
            position: absolute;
            top: 100%; left: 0; width: 100%;
            padding: clamp(60px, 12vw, 100px) clamp(15px, 6vw, 45px);
            box-sizing: border-box;
            color: #fff; text-align: center;
        }
        @keyframes scrollUp { from { transform: translateY(0); } to { transform: translateY(-115%); } }

        .poem-title { font-family: var(--font-heading); font-size: clamp(3.2rem, 12vw, 4.5rem); color: #ffb7c5; margin: 40px 0 20px; }
        .poem-body { font-size: clamp(1.2rem, 4.8vw, 1.6rem); line-height: 2; white-space: pre-wrap; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }

        /* Rope Drop UI - Simulated physics */
        #gallery-nav {
            position: absolute;
            top: -450px; left: 50%;
            transform: translateX(-50%);
            z-index: 3000;
            pointer-events: none;
            transition: top 2.5s cubic-bezier(0.175, 0.885, 0.32, 1.35);
            display: flex; flex-direction: column; align-items: center;
            width: 100%;
        }
        #gallery-nav.show { top: 50%; transform: translate(-50%, -50%); pointer-events: auto; }
        
        /* The Actual Rope */
        #gallery-nav::before {
            content: ''; position: absolute; top: -100vh;
            width: 3px; height: 100vh;
            background: linear-gradient(to bottom, transparent, #ffffff, #ffb7c5);
            box-shadow: 0 0 15px rgba(255, 182, 193, 0.6);
            z-index: -1;
        }

        #music-modal, #message-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92);
            z-index: 6000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(20px);
            padding: 20px;
            box-sizing: border-box;
        }
        #music-modal.open, #message-modal.open { display: flex; }

        .modal-content-wrapper {
            background: rgba(44, 14, 24, 0.95);
            width: 100%; max-width: 440px; 
            max-height: 85vh;
            border: 1px solid rgba(255, 183, 197, 0.5);
            border-radius: 40px; padding: clamp(25px, 6vw, 40px);
            overflow-y: auto; box-shadow: 0 0 60px rgba(0,0,0,0.9);
            text-align: center;
            box-sizing: border-box;
        }

        .music-item {
            padding: 15px; border-bottom: 1px solid rgba(255, 183, 197, 0.15);
            display: flex; align-items: center; justify-content: space-between;
            cursor: pointer; transition: all 0.3s; font-family: var(--font-accent);
        }
        .music-item span { font-size: clamp(1rem, 4.2vw, 1.3rem); color: #ffe4e1; text-align: left; }

        textarea {
            width: 100%; height: clamp(120px, 25vh, 180px); margin: 20px 0;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,182,193,0.4);
            border-radius: 25px; color: white; padding: 20px;
            font-family: var(--font-body); font-size: 1.2rem; outline: none; box-sizing: border-box;
        }

        #tap-hint {
            position: fixed; 
            bottom: clamp(20px, 8vh, 50px); 
            width: 100%;
            text-align: center; color: rgba(255,255,255,0.6);
            font-family: var(--font-accent);
            font-size: clamp(1.2rem, 5vw, 1.5rem); 
            pointer-events: none; z-index: 101;
            padding: 0 20px;
            box-sizing: border-box;
        }
        .fade-out { animation: fadeOutEffect 2s forwards; }
        @keyframes fadeOutEffect { to { opacity: 0; } }
    </style>
</head>
<body onload="init()">

    <audio id="bg-music" preload="auto"></audio>

    <button id="music-control-btn" class="music-control">
        <span id="music-icon">‚ô™</span> <span id="music-text">Play</span>
    </button>

    <canvas id="snow-canvas"></canvas>
    <canvas id="confetti"></canvas>

    <div id="main-countdown">
        <div id="header-container">
            <h2>Counting down to You</h2>
            <div class="subtitle">Every second is a heartbeat</div>
            <button id="wanna-listen-btn" class="music-prompt-btn">Special dedication</button>
            <div id="lyrics-container"><div id="lyric-text"></div></div>
        </div>
        <div class="clock-wrapper" id="clock">
            <div class="time-group">
                <div class="digits-row">
                    <div class="digit" id="d-1"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                    <div class="digit" id="d-2"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                </div>
                <div class="label">Days</div>
            </div>
            <div class="time-group">
                <div class="digits-row">
                    <div class="digit" id="h-1"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                    <div class="digit" id="h-2"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                </div>
                <div class="label">Hours</div>
            </div>
            <div class="time-group">
                <div class="digits-row">
                    <div class="digit" id="m-1"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                    <div class="digit" id="m-2"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                </div>
                <div class="label">Mins</div>
            </div>
            <div class="time-group">
                <div class="digits-row">
                    <div class="digit" id="s-1"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                    <div class="digit" id="s-2"><div class="hexagon seg-0"></div><div class="hexagon seg-1"></div><div class="hexagon seg-2"></div><div class="hexagon seg-3"></div><div class="hexagon seg-4"></div><div class="hexagon seg-5"></div><div class="hexagon seg-6"></div></div>
                </div>
                <div class="label">Secs</div>
            </div>
        </div>
    </div>

    <div id="love-letter">
        <div class="letter-content">
            <h1>Happy New Year!</h1>
            <p>My Dearest Momma,</p>
            <p>Another year has passed, but my love for you has only grown. You are mi favorita y mi bonita</p>
            <button id="view-journey-btn" class="action-btn heartbeat-pulse">Take Me Back</button>
        </div>
    </div>

    <div id="memories-gallery">
        <div id="poem-container">
            <div id="glass-panel">
                <div id="scrolling-text">
                    <div class="poem-title">Mi Favorita üíñ</div>
                    <div class="poem-body" id="dynamic-poem"></div>
                    <br><br>
                    <div class="poem-title" id="final-heart">I Love You ‚ù§Ô∏è</div>
                    <br><br>
                </div>
            </div>
        </div>
        <!-- Accept Button - Drops from rope -->
        <div id="gallery-nav">
             <button id="gallery-accept-btn" class="action-btn heartbeat-pulse">Accept My Love ‚ù§Ô∏è</button>
        </div>
    </div>

    <div id="music-modal">
        <div class="modal-content-wrapper">
            <div style="font-family: var(--font-heading); color: #ffb7c5; font-size: 2.8rem; margin-bottom: 15px;">Special Dedication</div>
            <div id="music-list"></div>
            <button id="close-music-btn" class="action-btn" style="margin-top: 20px; font-size: 1.1rem; max-width: 250px;">Close</button>
        </div>
    </div>

    <div id="message-modal">
        <div class="modal-content-wrapper">
            <h3 style="font-family: var(--font-heading); font-size: 3rem; color: #ffb7c5; margin: 0;">Write to me...</h3>
            <p style="font-family: var(--font-accent); font-size: 1.4rem; margin: 5px 0; color: #ffe4e1;">Tell me how you feel, my heart.</p>
            <textarea id="whatsapp-msg" placeholder="Type your sweet message here..."></textarea>
            <button id="send-whatsapp-btn" class="action-btn">Send to Me üíå</button>
            <br>
            <button id="close-accept-btn" class="music-prompt-btn" style="margin-top: 15px;">Cancel</button>
        </div>
    </div>

    <div id="tap-hint">Tap anywhere to hear our heartbeats</div>

<script>
    const baseRepoUrl = "https://raw.githubusercontent.com/Princemicah001/new-year/main/";
    
    const filenames = [
        "20250504_121454.jpg", "20250603_170520.jpg", "20250607_100031.jpg", "20250616_164501.jpg",
        "20250629_130951.jpg", "20250826_172812.jpg", "20250826_172857.jpg", "20250826_173305.jpg",
        "20250826_182448.jpg", "20250826_182912.jpg", "20250903_083545 (1).jpg", "20250903_083545.jpg",
        "20250905_170733.jpg", "20250905_170752.jpg", "20250905_170807.jpg", "20250919_211234.jpg",
        "20250920_211411.jpg", "20250920_211807.jpg", "20250920_211945.jpg", "20250921_100329.jpg",
        "20251003_181454.jpg", "20251003_201225.jpg", "20251023_094043.jpg", "20251023_175359.jpg",
        "20251023_231303.jpg", "20251023_231327.jpg", "20251203_133411.jpg", "20251204_190618.jpg",
        "20251211_200819.jpg", "20251219_115557.jpg", "IMG-20250718-WA0000.jpg", "IMG_3687.jpg",
        "Screenshot_20250218_120136_WhatsAppBusiness.jpg", "Screenshot_20250416_235314_WhatsApp.jpg",
        "Screenshot_20250427_205259_WhatsAppBusiness.jpg", "Screenshot_20250618_224103_Gallery.png"
    ];
    const imageLinks = filenames.map(file => baseRepoUrl + encodeURIComponent(file));

    const FULL_PLAYLIST = [
        { title: "Photograph", file: "Ed Sheeran - Photograph.mp3", lyrics: ["Loving can hurt sometimes", "But it's the only thing that I know", "We keep this love in a photograph", "We made these memories for ourselves"] },
        { title: "Perfect", file: "Edd_Sheeran_-_Perfect_(mp3.pm).mp3", lyrics: ["I found a love for me", "Darling, just dive right in", "Follow my lead", "I found a girl, beautiful and sweet"] },
        { title: "All Of Me", file: "John-Legend-%E2%80%93-All-Of-Me.mp3", lyrics: ["'Cause all of me loves all of you", "Love your curves and all your edges", "All your perfect imperfections", "Give your all to me, I'll give my all to you"] },
        { title: "Thinking Out Loud", file: "Edsheeran_-_thinking_out_loud_(mp3.pm).mp3", lyrics: ["When your legs don't work like they used to before", "And I can't sweep you off of your feet", "Will your mouth still remember the taste of my love?", "Honey, I'll be loving you 'til we're seventy"] },
        { title: "Still The One", file: "shania_twain_-_u_are_still_the_one_(mp3.pm).mp3", lyrics: ["You're still the one I run to", "The one that I belong to", "You're still the one I want for life", "You're still the one"] },
        { title: "Halo", file: "Rihanna_-_Halo_(mp3.pm).mp3", lyrics: ["Remember those walls I built?", "Well, baby they're tumbling down", "And they didn't even put up a fight", "They didn't even make a sound"] }
    ];

    const JOURNEY_PLAYLIST = [ FULL_PLAYLIST[0], FULL_PLAYLIST[1], FULL_PLAYLIST[4] ];

    const audio = document.getElementById('bg-music');
    let playlistIndex = 0;
    let lyricInterval;
    let celebrationTriggered = false;
    let currentSlide = 0;
    const POEM_DURATION = 40; 
    const targetDate = new Date(2026, 0, 1); 

    async function changeSong(url, songObj) {
        audio.pause();
        audio.src = url;
        audio.load();
        try {
            await audio.play();
            updateMusicBtnState(true, songObj.title);
            startLyricCycle(songObj.lyrics);
        } catch (err) {
            setTimeout(() => audio.play().catch(() => {}), 100);
        }
    }

    function startLyricCycle(lyrics) {
        if (!lyrics || lyrics.length === 0) return;
        clearInterval(lyricInterval);
        const lyricEl = document.getElementById('lyric-text');
        let i = 0;
        const cycle = () => {
            lyricEl.style.opacity = 0;
            setTimeout(() => {
                lyricEl.innerText = lyrics[i];
                lyricEl.style.opacity = 1;
                i = (i + 1) % lyrics.length;
            }, 1500);
        };
        cycle();
        lyricInterval = setInterval(cycle, 6000);
    }

    async function safePlay(el) {
        try { await el.play(); } catch (err) {}
    }

    async function init() {
        initSnow();
        startConfetti(); 
        updateTime();
        setInterval(updateTime, 1000);
        document.getElementById('dynamic-poem').innerText = generateLongPoem();
        
        playlistIndex = Math.floor(Math.random() * FULL_PLAYLIST.length);
        const startSong = FULL_PLAYLIST[playlistIndex];
        audio.src = baseRepoUrl + encodeURIComponent(startSong.file);

        document.getElementById('music-control-btn').onclick = toggleMusic;
        document.getElementById('view-journey-btn').onclick = startJourney;
        document.getElementById('gallery-accept-btn').onclick = openAcceptModal;
        document.getElementById('close-accept-btn').onclick = closeAcceptModal;
        document.getElementById('wanna-listen-btn').onclick = () => document.getElementById('music-modal').classList.add('open');
        document.getElementById('close-music-btn').onclick = () => document.getElementById('music-modal').classList.remove('open');

        // Provided WhatsApp Logic
        document.getElementById("send-whatsapp-btn").addEventListener("click", function () {
            const message = document.getElementById("whatsapp-msg").value.trim();
            if (message === "") return;
            const phoneNumber = "254707865597"; 
            const encodedMessage = encodeURIComponent(message);
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            window.open(whatsappURL, "_blank");
            closeAcceptModal();
        });

        renderMusicList();

        try {
            await audio.play();
            updateMusicBtnState(true, startSong.title);
            startLyricCycle(startSong.lyrics);
            document.getElementById('tap-hint').style.display = 'none';
        } catch (e) {
            const handleFirstInteraction = () => {
                safePlay(audio).then(() => {
                    const song = FULL_PLAYLIST[playlistIndex];
                    updateMusicBtnState(true, song.title);
                    startLyricCycle(song.lyrics);
                    const hint = document.getElementById('tap-hint');
                    hint.classList.add('fade-out');
                    setTimeout(() => hint.style.display = 'none', 2000);
                });
                document.body.removeEventListener('click', handleFirstInteraction);
            };
            document.body.addEventListener('click', handleFirstInteraction);
        }

        audio.onended = () => {
            let list = document.getElementById('memories-gallery').style.display === 'block' ? JOURNEY_PLAYLIST : FULL_PLAYLIST;
            playlistIndex = (playlistIndex + 1) % list.length;
            const nextSong = list[playlistIndex];
            changeSong(baseRepoUrl + encodeURIComponent(nextSong.file), nextSong);
        };
    }

    function renderMusicList() {
        const list = document.getElementById('music-list');
        FULL_PLAYLIST.forEach((song, index) => {
            const div = document.createElement('div');
            div.className = 'music-item';
            div.innerHTML = `<span>${song.title}</span><span style="color:#ffb7c5;display:none">‚ñ∂</span>`;
            div.onclick = () => {
                playlistIndex = index;
                changeSong(baseRepoUrl + encodeURIComponent(song.file), song);
                document.getElementById('music-modal').classList.remove('open');
            };
            list.appendChild(div);
        });
    }

   function generateLongPoem() {
    const segments = [
        `Momma üåπ,\n\nA beautiful storyüíçours.\nIt didn‚Äôt begin in a book or a movie scene, but with a simple link and a curious click.\nI still smile when I remember how I first ‚Äúhacked‚Äù your location, not knowing that moment would be the one where you quietly, effortlessly hacked my heart.\nWhat started as curiosity became conversation, and conversation turned into comfort.\nEvery word we shared opened a new door, every laugh wrote a new line, and before I knew it, we were standing at the beginning of an endless chapter‚Äîone I never want to close.\nYou didn‚Äôt just enter my life, you changed its rhythm, and suddenly every day had a softer, sweeter beat. üòç`,
        
        `Those chats‚Ä¶ü•∞ oh, those chats.\nThey melted into long calls that felt like minutes, even when hours slipped away.\nWe talked until the stars got tired and the night quietly gave up on us.\nWe shared dreams without fear, laughed without holding back, and healed pieces of ourselves without even trying.\nSomewhere between ‚Äúgoodnight‚Äù and ‚Äúare you still there?‚Äù, a lovely stranger became my safest place.\nAnd that friend‚Äîmy God‚Äîthat friend became my whole world, my peace, my favorite notification, my calm in the chaos.`,
        
        `Then came the moment my heart still replays in slow motion.\nThe first time we met in person‚ù£Ô∏è.\nI saw you, and everything paused.\nNo noise, no rush‚Äîjust you.\nI knew right then I had hit the jackpot‚Ä¶ not just a jackpot, but the kind people search for their entire lives. üòç\nYou were more stunning than my imagination ever dared to hope, and somehow, every time I see you, you get even more beautiful.\nWe were so wrapped in each other‚Äôs presence that the world disappeared, and I almost lost my phone‚Äîbut I had already found something far more valuable. üë∏`,
        
        `In your arms, I found my true home ‚ù§Ô∏è.\nNot a place, not a moment‚Äîbut a feeling.\nYour kindness is rare, the kind that doesn‚Äôt make noise but changes everything.\nYou give me a serenity I never knew I needed, a calm that settles deep in my soul.\nYour beauty‚Äîinside and out‚Äîis unmatched, effortless, and real.\nYou see me, you believe in me, and your confidence in me makes me want to be better every single day.\nYou don‚Äôt judge me, you don‚Äôt try to change me‚Äîyou love me, fully and freely, and that is more than enough.`,
        
        `Every experience we‚Äôve shared has been worth it.\nThe risks, the scares, the moments that made our hearts race‚Äîmmmh, all of it.\nEvery step led me closer to you, and I‚Äôd take them all again without hesitation.\nYou are the sweetest piece of cake I could ever ask for, and I swear, I‚Äôd happily eat that cake for the rest of my life. üç∞\nYour curves, your smile, your complexion, the way you carry yourself with quiet confidence‚Äîit all lives rent-free in my heart.\nYou don‚Äôt just turn heads, you hold hearts‚Ä¶ and you‚Äôre holding mine.`,
        
        `"You're Still The One," and I know it‚Äôs the purest truth. üòç\nThrough every mile, every busy day, every silent prayer‚Ä¶\nYou are still the one I run to.\nYou are still the one I belong to.\nYou are still the one I choose, again and again, without doubt.\nWith you, love doesn‚Äôt feel heavy‚Äîit feels right.\nWith all my heartüíû, I stand here grateful, steady, and deeply in love.`,
        `2025 is no longer with us.\nLet it mark the beginning of a chapter, one of many years we‚Äôll count together, side by side, laughing through the seasons, growing through the moments, until time itself wears us down and our teeth finally fall out‚Ä¶ and even then, I‚Äôll still be choosing you.üíû`,
        `I love you more today than I did yesterday.\nBut love, let me promise you this:\nEven today is less than what I‚Äôll feel tomorrow.\nBecause my love for you grows üíã deeper with every heartbeat, ü¶ã\ncounting down to a forever that belongs only to us.\nYou are my heart, my calm, my blessing, and my greatest surprise.\n\nYours Forever,\nPrince(ss) üíñ`,
        
        `‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è`
    ];
    return segments.join("\n\n~ * ~ * ~ * ~\n\n");
}


    function updateTime() {
        const diff = targetDate - new Date();
        if (diff <= 0) {
            if (!celebrationTriggered) { celebrationTriggered = true; triggerRomance(); }
            ['d','h','m','s'].forEach(p => { if(document.getElementById(`${p}-1`)) { updateDigit(`${p}-1`, 0); updateDigit(`${p}-2`, 0); } });
            return;
        }
        const d=Math.floor(diff/864e5),h=Math.floor((diff/36e5)%24),m=Math.floor((diff/6e4)%60),s=Math.floor((diff/1e3)%60);
        updateDigit('d-1',Math.floor(d/10));updateDigit('d-2',d%10);
        updateDigit('h-1',Math.floor(h/10));updateDigit('h-2',h%10);
        updateDigit('m-1',Math.floor(m/10));updateDigit('m-2',m%10);
        updateDigit('s-1',Math.floor(s/10));updateDigit('s-2',s%10);
    }

    function toggleMusic() {
        if (audio.paused) { safePlay(audio); updateMusicBtnState(true, "Playing..."); } 
        else { audio.pause(); updateMusicBtnState(false, "Paused"); }
    }

    function updateMusicBtnState(isPlaying, text) {
        document.getElementById('music-text').innerText = text; 
        document.getElementById('music-icon').innerText = isPlaying ? "‚è∏" : "‚ô™";
    }

    const digitMap = {
        0:[1,1,1,0,1,1,1],1:[0,0,1,0,0,1,0],2:[1,0,1,1,1,0,1],3:[1,0,1,1,0,1,1],4:[0,1,1,1,0,1,0],
        5:[1,1,0,1,0,1,1],6:[1,1,0,1,1,1,1],7:[1,0,1,0,0,1,0],8:[1,1,1,1,1,1,1],9:[1,1,1,1,0,1,1]
    };
    function updateDigit(id, val) {
        const d = document.getElementById(id);
        if(!d) return;
        const segs = d.querySelectorAll('.hexagon');
        const map = digitMap[val];
        segs.forEach((s, i) => map[i] ? s.classList.add('on') : s.classList.remove('on'));
    }

    function triggerRomance() {
        document.getElementById('main-countdown').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('main-countdown').style.display = 'none';
            document.getElementById('love-letter').classList.add('visible');
        }, 1000);
    }

    function startJourney() {
        const letter = document.getElementById('love-letter');
        const gallery = document.getElementById('memories-gallery');
        const canvas = document.getElementById('confetti');
        
        gallery.appendChild(canvas);
        canvas.style.zIndex = "20";
        
        letter.classList.remove('visible');
        setTimeout(() => {
            letter.style.display = 'none';
            gallery.style.display = 'block';
            setTimeout(() => {
                gallery.classList.add('active');
                initGallery();
                playlistIndex = 0;
                changeSong(baseRepoUrl + encodeURIComponent(JOURNEY_PLAYLIST[0].file), JOURNEY_PLAYLIST[0]);
            }, 50);
        }, 1000);
    }

    function initGallery() {
        const gal = document.getElementById('memories-gallery');
        imageLinks.forEach((link, idx) => {
            const div = document.createElement('div');
            div.className = `slide ${idx === 0 ? 'active' : ''}`;
            const img = new Image();
            img.src = link;
            img.onload = () => div.style.backgroundImage = `url('${link}')`;
            gal.insertBefore(div, document.getElementById('poem-container'));
        });

        const slideInterval = (POEM_DURATION * 1000) / imageLinks.length;
        setInterval(() => {
            const slides = document.querySelectorAll('.slide');
            if(slides.length > 0) {
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }
        }, slideInterval);
        
        const scrollText = document.getElementById('scrolling-text');
        scrollText.style.animation = `scrollUp ${POEM_DURATION}s linear forwards`;

        const checkEnd = setInterval(() => {
            const finalHeart = document.getElementById('final-heart');
            const glass = document.getElementById('glass-panel');
            if(!finalHeart || !glass) return;

            const rect = finalHeart.getBoundingClientRect();
            const glassRect = glass.getBoundingClientRect();
            const middle = glassRect.top + (glassRect.height / 2);

            if (rect.top <= middle && rect.top > 0) {
                clearInterval(checkEnd);
                // Wrap the glass like a scroll
                glass.classList.add('scroll-wrap');
                // Clear the memory images to reveal simple background
                document.querySelectorAll('.slide').forEach(s => s.style.opacity = '0');
                
                // Rope drop the button
                setTimeout(() => {
                    document.getElementById('gallery-nav').classList.add('show');
                }, 1000);
            }
        }, 100);
    }

    function openAcceptModal() { document.getElementById('message-modal').classList.add('open'); }
    function closeAcceptModal() { 
        document.getElementById('message-modal').classList.remove('open');
        document.getElementById('music-modal').classList.remove('open');
    }

    // --- Snow Animation ---
    const sCanvas = document.getElementById('snow-canvas');
    const sCtx = sCanvas.getContext('2d');
    let flakes = [];
    function initSnow() {
        sCanvas.width = window.innerWidth; sCanvas.height = window.innerHeight;
        for(let i=0; i<80; i++) flakes.push({x: Math.random()*sCanvas.width, y: Math.random()*sCanvas.height, r: Math.random()*3+1, d: Math.random()*1});
        function draw() {
            sCtx.clearRect(0,0,sCanvas.width,sCanvas.height);
            sCtx.fillStyle = "rgba(255,255,255,0.7)";
            sCtx.beginPath();
            flakes.forEach(f => {
                sCtx.moveTo(f.x, f.y);
                sCtx.arc(f.x, f.y, f.r, 0, Math.PI*2, true);
                f.y += Math.pow(f.d, 2) + 1.2;
                f.x += Math.sin(f.y/60);
                if(f.y > sCanvas.height) { 
                    f.y = -10; 
                    f.x = Math.random()*sCanvas.width;
                }
            });
            sCtx.fill();
            requestAnimationFrame(draw);
        }
        draw();
    }

    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize() { 
        canvas.width = window.innerWidth; canvas.height = window.innerHeight; 
        sCanvas.width = window.innerWidth; sCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function startConfetti() {
        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (particles.length < 30) particles.push({
                x: Math.random() * canvas.width, y: -20, 
                s: Math.random() * 12 + 8, vy: Math.random() * 1 + 0.8,
                vx: Math.random() * 1 - 0.5, r: Math.random() * 360,
                c: `hsl(${Math.random() * 60 + 330}, 100%, 75%)`
            });
            particles.forEach((p, i) => {
                p.y += p.vy; p.x += p.vx; p.r += 0.4;
                ctx.save();
                ctx.translate(p.x, p.y); ctx.rotate(p.r * Math.PI / 180);
                ctx.fillStyle = p.c; ctx.font = p.s + "px Arial";
                ctx.fillText("‚ù§", -p.s/2, p.s/2);
                ctx.restore();
                if (p.y > canvas.height) { particles[i].y = -20; particles[i].x = Math.random() * canvas.width; }
            });
            requestAnimationFrame(loop);
        }
        loop();
    }
</script>
</body>
</html>